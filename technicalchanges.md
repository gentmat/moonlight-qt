# Technical changes

## Modified
- app/app.pro
  - Adds CloudDeck API sources/headers and include path so the manager is built and visible to the app.
- app/main.cpp
  - Registers `CloudDeckManagerApi` as a QML singleton for CloudDeck API access.
- app/gui/PcView.qml
  - Adds CloudDeck-aware context menu actions and a richer PC details dialog with CloudDeck credentials and Sunshine defaults.
  - Adds three dedicated right-click views for CloudDeck hosts: `View Details`, `CloudDeck Settings`, and `Session Timer Settings`.
  - Restores normal click-to-pair behavior; CloudDeck pairing is handled in the dialog flow.
  - Splits generic host details, CloudDeck credentials/Sunshine defaults, and timer configuration into separate focused dialogs.
  - Keeps the session timer controls compact with tighter spacing and smaller numeric inputs.
  - Defaults are now: `Only show before end`, `5` minutes remaining, and hourly reminder enabled for `5` seconds.
  - Fixes CloudDeck context actions disappearing after restart/offline by removing menu dependence on transient `paired` state.
  - Uses layered CloudDeck host detection in QML (UUID, then stored-address match, then hostname pattern fallback).
  - Adds startup/add-time UUID reconciliation from the saved CloudDeck server address to keep host UUID mapping current.
- app/gui/CloudDeckDialog.qml
  - Guards CloudDeck startup/pairing signal handlers against stale async callbacks after flow reset/close.
  - Adds validation before start commands to avoid empty machine/token command attempts.
  - Normalizes machine-status string parsing and validates `public_ip` before manual host add, preventing crash-prone empty/invalid host submissions.
  - Persists CloudDeck host UUID via address-based re-resolution to avoid stale index races when host lists reorder.
  - Persists/refreshes CloudDeck host UUID earlier in flow (after host add success and during manual start running-state confirmation).
- app/gui/StreamSegue.qml
  - Adds one-shot CloudDeck `last_started` resolution before `session.start()` (login/machineId/status chain only when needed).
  - Applies fetched start timestamp and all timer display preferences to `Session` once, with timeout/fallback behavior and no polling during stream.
  - Ignores `last_started` values unless CloudDeck status is `running`, preventing stale timestamps during startup transitions.
- app/gui/main.qml
  - Updates the Add PC dialog to offer credential login vs manual entry and removes the separate CloudDeck toolbar button.
- app/gui/computermodel.cpp
  - Adds `findComputerByManualAddress()` helper to resolve a host by manual address for CloudDeck pairing flow.
  - Exposes active/manual address strings for CloudDeck host detection in QML.
  - Adds an index safety guard in `handleComputerStateChanged()` to avoid emitting `dataChanged()` with an invalid model index when stale pointers arrive.
- app/gui/computermodel.h
  - Declares the new `findComputerByManualAddress()` QML‑invokable method.
  - Adds QML roles for active/manual addresses.
- clouddeck/clouddeckmanagerapi.cpp
  - Implements CloudDeck REST/Cognito flows (login, GetUser, account lookup, machine status/start/stop, add client).
  - Tracks access-token expiry time and exposes seconds-remaining/expired helpers to QML.
  - Polls machine status during transitions and caches password/public IP/timestamps for the UI.
  - Adds persisted CloudDeck timer preferences with validation: hours, visibility mode, before-end minutes, hourly reminder enabled flag, and hourly reminder seconds.
  - Sets defaults to before-end visibility with `5` minute threshold and hourly reminder enabled.
  - Treats machine-command HTTP `409` conflict responses during active transitions as transient and keeps polling state instead of surfacing a hard failure.
  - Extends `isCloudDeckHost()` with hostname-label fallback (`clouddeck`) so domains like `*.my.clouddeck.app` still identify as CloudDeck when UUID/address mappings are missing or stale.
- clouddeck/clouddeckmanagerapi.h
  - Declares CloudDeck REST API surface, token expiry helpers, and machine metadata accessors for QML.
  - Declares CloudDeck timer preference getters/setters for QML usage.
- app/streaming/session.h
  - Adds QML invokables for current host address and full CloudDeck timer configuration.
  - Adds internal state for timer display mode, before-end threshold, and hourly reminder windows.
- app/streaming/session.cpp
  - Computes elapsed session age from CloudDeck `last_started` against current UTC time and updates a live in-stream counter.
  - Implements timer visibility modes: always visible, before-end countdown, and hidden.
  - Implements optional hourly reminder popups (shown for configurable seconds at each full elapsed hour) without extra API calls.
- app/streaming/video/overlaymanager.h
  - Adds a new overlay type for the CloudDeck session timer.
- app/streaming/video/overlaymanager.cpp
  - Defines styling for the new session timer overlay (font/color).
- app/streaming/video/ffmpeg-renderers/sdlvid.cpp
  - Positions the session timer overlay at top-center.
- app/streaming/video/ffmpeg-renderers/dxva2.cpp
  - Positions the session timer overlay at top-center.
- app/streaming/video/ffmpeg-renderers/d3d11va.cpp
  - Positions the session timer overlay at top-center.
- app/streaming/video/ffmpeg-renderers/eglvid.cpp
  - Positions the session timer overlay at top-center.
- app/streaming/video/ffmpeg-renderers/drm.cpp
  - Positions the session timer overlay at top-center.
- app/streaming/video/ffmpeg-renderers/vdpau.cpp
  - Positions the session timer overlay at top-center.
- app/streaming/video/ffmpeg-renderers/vaapi.cpp
  - Positions the session timer overlay at top-center.
- app/streaming/video/ffmpeg-renderers/plvk.cpp
  - Positions the session timer overlay at top-center.
- app/streaming/video/ffmpeg-renderers/vt_metal.mm
  - Positions the session timer overlay at top-center.
- app/streaming/video/ffmpeg-renderers/vt_avsamplelayer.mm
  - Sets session timer text alignment to centered.
- app/qml.qrc
  - Registers `CloudDeckDialog.qml` in the QML resource list.
- app/resources.qrc
  - Registers the `cloud.svg` icon in the app resources.
- changes.md
  - Updated to include the clean rebuild script and documentation files in the change list.
- technicalchanges.md
  - Updated to describe the clean rebuild script and documentation updates.

## Added
- clouddeck/clouddeckmanagerapi.cpp
  - Implements the CloudDeck REST/Cognito API client with machine lifecycle polling.
- clouddeck/clouddeckmanagerapi.h
  - Declares the CloudDeck REST API surface and QML helpers.
- app/gui/CloudDeckDialog.qml
  - New dialog UI for CloudDeck login/pairing operations and status display.
  - Automates pairing: add host, generate/send PIN after a delay, retry mismatches, and close on success.
- app/res/cloud.svg
  - Cloud icon used by the new toolbar button.
- clean_rebuild.sh
  - Cleans in‑tree build artifacts and rebuilds the project from the root with `qmake6` and `make`.
- clean_rebuild.bat
  - Adds a Windows clean rebuild script that bootstraps the VS toolchain/Qt bin path and rebuilds using `qmake` plus `jom`/`nmake`.
  - Copies runtime DLLs from `libs/windows/lib/x64` plus `AntiHooking.dll` into the build output so the release exe has required dependencies (SDL2, SDL2_ttf, etc.).
